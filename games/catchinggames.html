<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" href="../assets/programmerist.png" type="image/x-icon" />
  <title>üçí Catch-and-Collect Game üçí</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: row;
      height: 100vh;
      margin: 0;
      background: white;
      color: black;
    }

    /* ===== START SCREEN ===== */
    #startScreen {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255,255,255,0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }

    #startScreen h2 {
      margin-bottom: 15px;
    }

    #startScreen input, 
    #startScreen select,
    #startScreen button {
      margin: 8px;
      padding: 10px;
      font-size: 16px;
    }

    /* Left: game container */
    .game-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow-y: auto;
    }

    h2 {
      margin-bottom: 20px;
      text-align: center;
      color: black;
    }

    /* Right: prize image container */
    .image-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background-color: transparent;
    }

    #gameCanvas {
      background: #eee;
      border: 3px solid #000;
      border-radius: 12px;
      display: block;
      image-rendering: pixelated;
    }

    #prize {
      display: none;
      margin-top: 20px;
      text-align: center;
    }

    #prize h3 {
      color: black;
    }

    #prize img {
      max-width: 300px;
      border: 5px solid #000;
      border-radius: 12px;
    }

    /* Message */
    p#message {
      margin-top: 10px;
      font-size: 18px;
      color: green;
    }

    /* ====== RESPONSIVE ====== */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
        height: auto;
      }
      #gameCanvas {
        width: 300px;
        height: 400px;
      }
    }

    @media (max-width: 480px) {
      #gameCanvas {
        width: 250px;
        height: 350px;
      }
      #prize img {
        max-width: 220px;
      }
    }
  </style>
</head>
<body>
  <!-- START SCREEN -->
  <div id="startScreen">
    <h2>üéÆ Enter Your Details</h2>
    <input type="text" id="nickname" placeholder="Enter your nickname">
    <select id="targetSelect">
      <option value="10">Easy ‚Äì Collect 10 items</option>
      <option value="20">Medium ‚Äì Collect 20 items</option>
      <option value="30">Hard ‚Äì Collect 30 items</option>
    </select>
    <button onclick="startGame()">Start Game</button>
  </div>

  <!-- LEFT SIDE: Game -->
  <div class="game-container">
    <h2 id="gameTitle">Catch and Collect</h2>
    <canvas id="gameCanvas" width="400" height="500"></canvas>
  </div>

  <!-- RIGHT SIDE: Prize -->
  <div class="image-container">
    <div id="prize">
      <h3 id="winTitle">üéâ You Win! üéâ</h3>
      <img id="prizeImg" src="" alt="Prize">
      <p id="message">Great job collecting all items!</p>
    </div>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let items = [];
    let score = 0;
    let targetScore = 10; // default
    let nickname = "";

    // Prize images for difficulty
    const prizeImages = {
      10: "../assets/anime.jpg",
      20: "../assets/animegirl.jpg",
      30: "../assets/cutegirl.jpg"
    };

    // Difficulty labels
    const difficultyNames = {
      10: "Easy",
      20: "Medium",
      30: "Hard"
    };

    // Track pressed keys
    const keys = {};

    // Player
    const player = {
      x: canvas.width / 2 - 15,
      y: canvas.height - 40,
      width: 30,
      height: 30,
      speed: 200, // pixels per second
    };

    // Falling Item
    class Item {
      constructor() {
        this.x = Math.random() * (canvas.width - 20);
        this.y = -20;
        this.size = 20;
        this.speed = 100 + Math.random() * 100;
      }
      draw() {
        ctx.fillStyle = "orange";
        ctx.fillRect(this.x, this.y, this.size, this.size);
      }
      update(delta) {
        this.y += this.speed * delta;
        this.draw();
      }
    }

    function spawnItem() {
      items.push(new Item());
    }

    function drawPlayer() {
      ctx.fillStyle = "blue";
      ctx.fillRect(player.x, player.y, player.width, player.height);
    }

    function checkCollision(item, player) {
      return (
        item.x < player.x + player.width &&
        item.x + item.size > player.x &&
        item.y < player.y + player.height &&
        item.y + item.size > player.y
      );
    }

    let lastTime = 0;
    function animate(timestamp) {
      const delta = (timestamp - lastTime) / 1000;
      lastTime = timestamp;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Score + nickname + target
      ctx.fillStyle = "black";
      ctx.font = "16px Arial";
      ctx.fillText(
        nickname + " | Target: " + targetScore + " (" + difficultyNames[targetScore] + ") | Score: " + score,
        10, 
        20
      );

      // Handle player movement
      if (keys["ArrowRight"] || keys["d"]) {
        player.x += player.speed * delta;
      }
      if (keys["ArrowLeft"] || keys["a"]) {
        player.x -= player.speed * delta;
      }

      // Keep inside bounds
      if (player.x < 0) player.x = 0;
      if (player.x + player.width > canvas.width) {
        player.x = canvas.width - player.width;
      }

      // Draw player
      drawPlayer();

      // Update items
      items.forEach((item, index) => {
        item.update(delta);

        if (checkCollision(item, player)) {
          items.splice(index, 1);
          score++;
        }
        if (item.y > canvas.height) items.splice(index, 1);
      });

      // Check win
      if (score >= targetScore) {
        document.getElementById("prize").style.display = "block";
        document.getElementById("prizeImg").src = prizeImages[targetScore];
        document.getElementById("winTitle").textContent = 
          "üéâ " + nickname + ", You Win! üéâ";
        document.getElementById("message").textContent = 
          "Great job, " + nickname + "! You collected all " + targetScore + " items (" + difficultyNames[targetScore] + ") üéâ";
        return;
      }

      requestAnimationFrame(animate);
    }

    // Controls (track keys)
    document.addEventListener("keydown", (e) => {
      keys[e.key] = true;
    });

    document.addEventListener("keyup", (e) => {
      keys[e.key] = false;
    });

    // Start Game function
    function startGame() {
      nickname = document.getElementById("nickname").value || "Player";
      targetScore = parseInt(document.getElementById("targetSelect").value);
      document.getElementById("startScreen").style.display = "none";
      setInterval(spawnItem, 1000);
      requestAnimationFrame(animate);
    }
  </script>
</body>
</html>
